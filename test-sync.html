<!DOCTYPE html>
<html>
<head>
    <title>Cross-Tab Sync Test</title>
</head>
<body>
    <h1>Cross-Tab Sync Test</h1>
    <textarea id="editor" rows="10" cols="50" placeholder="Type here..."></textarea>
    <div id="status"></div>
    
    <script>
        const storageKey = 'kriya-collab'
        const editor = document.getElementById('editor')
        const status = document.getElementById('status')
        
        // Listen for storage changes
        window.addEventListener('storage', (e) => {
            if (e.key === storageKey && e.newValue) {
                const data = JSON.parse(e.newValue)
                status.textContent = `Received: ${data.type} - ${JSON.stringify(data.payload)}`
                
                if (data.type === 'operation' && data.payload.operation.type === 'replace') {
                    editor.value = data.payload.operation.content
                }
            }
        })
        
        // Send changes
        editor.addEventListener('input', () => {
            const operation = {
                type: 'replace',
                content: editor.value,
                position: 0
            }
            
            localStorage.setItem(storageKey, JSON.stringify({
                type: 'operation',
                payload: { operation },
                timestamp: Date.now()
            }))
        })
        
        status.textContent = 'Ready - Open this page in another tab and type'
    </script>
</body>
</html>