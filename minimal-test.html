<!DOCTYPE html>
<html>
<head>
    <title>Minimal Collab Test</title>
</head>
<body>
    <h1>Minimal Collaboration Test</h1>
    <textarea id="editor" style="width:100%;height:200px;"></textarea>
    <button onclick="toggleLive()">Toggle Live Mode</button>
    <div>Status: <span id="status">Solo</span></div>
    <div id="log"></div>
    
    <script>
        const editor = document.getElementById('editor')
        const status = document.getElementById('status')
        const log = document.getElementById('log')
        let isLive = false
        
        function addLog(msg) {
            log.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${msg}</div>`
            console.log(msg)
        }
        
        // Listen for storage events
        window.addEventListener('storage', (e) => {
            if (e.key === 'test-collab' && e.newValue) {
                const data = JSON.parse(e.newValue)
                addLog(`Received: ${data.type}`)
                if (data.type === 'content-change') {
                    editor.value = data.content
                    addLog(`Applied content: ${data.content.substring(0, 20)}...`)
                }
            }
        })
        
        // Send changes
        editor.addEventListener('input', () => {
            if (isLive) {
                const data = {
                    type: 'content-change',
                    content: editor.value,
                    timestamp: Date.now()
                }
                localStorage.setItem('test-collab', JSON.stringify(data))
                addLog(`Sent: ${editor.value.substring(0, 20)}...`)
            }
        })
        
        function toggleLive() {
            isLive = !isLive
            status.textContent = isLive ? 'Live' : 'Solo'
            addLog(`Mode: ${isLive ? 'Live' : 'Solo'}`)
        }
        
        addLog('Ready - Open in another tab, toggle Live mode, and type')
    </script>
</body>
</html>